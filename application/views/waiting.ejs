<%- include('partials/_head'); %>
<%- include('partials/_header'); %>

<style>
  body {
    background-color: black;
    color: white;
    margin: 0;
    font-family: 'Arial', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }

  h1 {
    color: red;
    font-size: 4rem;
    margin-bottom: 1rem;
    text-align: center;
  }

  p {
    font-size: 1.5rem;
  }
</style>

<h1>Netflix Wrapped</h1>
<p id="status">Waiting...</p>

<script>
  const statusEl = document.getElementById("status");

  async function sendToApi() {
    try {
      const response = await fetch('/process', {
        method: 'POST'
      });

      if (response.ok) {
        window.location.href = '/report';
      } else {
        statusEl.textContent = "Something went wrong with the API.";
      }
    } catch (e) {
      statusEl.textContent = "API failed or timed out.";
    }
  }

  setTimeout(() => {
    statusEl.textContent = "Still waiting... this might take longer than usual.";
  }, 3000);

  sendToApi();

  // Optional hard timeout
  setTimeout(() => {
    if (statusEl.textContent.startsWith("Waiting")) {
      statusEl.textContent = "API is not responding. Please try again later.";
    }
  }, 5000);
</script>

<%- include('partials/_footer'); %>